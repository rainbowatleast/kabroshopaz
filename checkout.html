<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout – KABROSHOPAZ</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
  }
  header {
    background: #ffffff;
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  .logo {
    font-size: 24px;
    font-weight: bold;
    color: #000;
  }
  .nav {
    display: flex;
    gap: 20px;
    align-items: center;
  }
  .nav a {
    text-decoration: none;
    color: #333;
    font-size: 16px;
  }
  .nav a:hover {
    color: #ff6600;
  }
  .container {
    max-width: 800px;
    margin: auto;
    padding: 20px;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  .summary {
    background: #ffffff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  .summary-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .summary-item:last-child {
    font-weight: bold;
  }
  form {
    background: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  form label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  form input, form textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  form button {
    padding: 12px 20px;
    background: #ff6600;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
  }
  form button:hover {
    background: #e65c00;
  }
  #order-success {
    display: none;
    background: #d1e7dd;
    color: #0f5132;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
  }
</style>
</head>
<body>
<header>
  <div class="logo">KABROSHOPAZ</div>
  <div class="nav">
    <a href="index.html">Ana Səhifə</a>
    <a href="cart.html">Səbət</a>
  </div>
</header>

<div class="container">
  <h2>Checkout</h2>
  <div class="summary" id="order-summary">
    <!-- Summary items will go here -->
  </div>
  <form id="checkout-form">
    <label for="name">Ad, soyad</label>
    <input type="text" id="name" required>
    <label for="phone">Telefon nömrəsi</label>
    <input type="tel" id="phone" required>
    <label for="address">Ünvan</label>
    <textarea id="address" rows="3" required></textarea>
    <label for="email">E-poçt (opsional)</label>
    <input type="email" id="email">
    <button type="submit">Sifarişi tamamla</button>
  </form>
  <div id="order-success">Sifarişiniz qeydə alındı! Tezliklə sizinlə əlaqə saxlayacağıq.</div>
</div>

<script>
function getCart() {
  return JSON.parse(localStorage.getItem('cart') || '[]');
}
function clearCart() {
  localStorage.removeItem('cart');
}
function renderSummary() {
  const cart = getCart();
  const summaryBox = document.getElementById('order-summary');
  if (cart.length === 0) {
    summaryBox.innerHTML = '<p>Səbətiniz boşdur...</p>';
    document.getElementById('checkout-form').style.display = 'none';
    return;
  }
  let total = 0;
  summaryBox.innerHTML = cart.map(item => {
    total += item.price * item.quantity;
    return `<div class="summary-item"><span>${item.name} × ${item.quantity}</span><span>${(item.price * item.quantity).toFixed(2)} AZN</span></div>`;
  }).join('');
  summaryBox.innerHTML += `<div class="summary-item"><span>Toplam</span><span>${total.toFixed(2)} AZN</span></div>`;
}
// Form submission
const form = document.getElementById('checkout-form');
form.addEventListener('submit', function (e) {
  e.preventDefault();
  // Collect form values
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const address = document.getElementById('address').value;
  const email = document.getElementById('email').value;
  const cart = getCart();
  // Construct a readable order summary
  let orderText = `Yeni sifariş:\n`;
  cart.forEach(item => {
    orderText += `• ${item.name} × ${item.quantity} = ${(item.price * item.quantity).toFixed(2)} AZN\n`;
  });
  const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);
  orderText += `\nToplam: ${total} AZN\n`;
  orderText += `Ad: ${name}\n`;
  orderText += `Telefon: ${phone}\n`;
  orderText += `Ünvan: ${address}\n`;
  if (email) {
    orderText += `Email: ${email}\n`;
  }
  // Encode the message for use in the Instagram DM link
  const encodedText = encodeURIComponent(orderText);
  const igDmUrl = `https://ig.me/kabroshopbaku?text=${encodedText}`;
  const igProfileUrl = 'https://www.instagram.com/kabroshopbaku?igsh=MWtmc2ZhZHA5NzBkaQ%3D%3D&utm_source=qr';
  // Copy the raw order text to clipboard if available
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(orderText).catch(() => {});
  }
  // Display instructions instead of automatically opening links. Some browsers block automatic pop‑ups
  const successBox = document.getElementById('order-success');
  successBox.innerHTML =
    `Sifarişiniz qeydə alındı! Sifariş məzmunu panoya kopyalandı. ` +
    `Instagram DM göndərmək üçün <a href="${igDmUrl}" target="_blank">bu linki</a> və ya ` +
    `<a href="${igProfileUrl}" target="_blank">profil linkini</a> açın və mətni yapışdırın.`;
  successBox.style.display = 'block';
  // Clear cart and reset form fields
  clearCart();
  form.reset();
});
renderSummary();
</script>
</body>
</html>
